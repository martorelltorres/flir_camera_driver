<launch>
  <arg name="camera" default="ch3" />   
  <arg name="base_topic" default="stereo_$(arg camera)" />
  <arg name="calibration" default="air" />
  <arg name="decimate" default="false"/>
  <arg name="decimation" default="2"/>
  <arg name="processing" default="true"/>
  <arg name="throttle" default="false"/>
  <arg name="left_ID" default="16401228"/>
  <arg name="right_ID" default="16401229"/>
  <arg name="control_frame_rate"        default="true" />
  <arg name="frame_rate"                default="5" />
  <arg name="left_camera_calibrated"    default="0" />
  <arg name="right_camera_calibrated"   default="0" />
  <arg name="run_stereo_image_proc"     default="false" />

  <!-- Driver -->
    <group ns="left" >
      <!-- Camera nodelet -->
      <node pkg="nodelet" type="nodelet" name="camera_nodelet"
            args="load spinnaker_camera_driver/SpinnakerCameraNodelet /camera_nodelet_manager" >
        <param name="frame_id"                        value="$(arg base_topic)" />
        <param name="serial"                          value="$(arg left_ID)" />

        <!-- Frame rate -->
        <param name="acquisition_frame_rate_enable"   value="$(arg control_frame_rate)" />
        <param name="acquisition_frame_rate"          value="$(arg frame_rate)" />

        <!-- Use the camera_calibration package to create this file -->
        <param name="camera_info_url" if="$(arg left_camera_calibrated)"
               value="file://$(find spinnaker_camera_driver)/config/ch3/CM3-U3-31S4C_$(arg left_camera_serial)/calibration_air.yaml" />
      </node>
      <!-- Debayering nodelet -->
      <node pkg="nodelet" type="nodelet" name="image_proc_debayer"
          args="load image_proc/debayer /camera_nodelet_manager">
      </node>
    </group>

    <group ns="right" >
      <!-- Camera nodelet -->
      <node pkg="nodelet" type="nodelet" name="camera_nodelet"
            args="load spinnaker_camera_driver/SpinnakerCameraNodelet /camera_nodelet_manager" >
        <param name="frame_id"                        value="$(arg base_topic)" />
        <param name="serial"                          value="$(arg right_ID)" />

        <!-- Frame rate -->
        <param name="acquisition_frame_rate_enable"   value="$(arg control_frame_rate)" />
        <param name="acquisition_frame_rate"          value="$(arg frame_rate)" />

        <!-- Use the camera_calibration package to create this file -->
        <param name="camera_info_url" if="$(arg right_camera_calibrated)"
               value="file://$(find spinnaker_camera_driver)/config/ch3/CM3-U3-31S4C_$(arg right_camera_serial)/calibration_air.yaml" />
      </node>
      <!-- Debayering nodelet -->
      <node pkg="nodelet" type="nodelet" name="image_proc_debayer"
          args="load image_proc/debayer /camera_nodelet_manager">
      </node>
    </group>

    <!-- Stereo image processing nodelet -->
    <group if="$(arg run_stereo_image_proc)" >
      <node pkg="stereo_image_proc" type="stereo_image_proc" name="stereo_image_proc">
        <param name="approximate_sync" value="true"/>
      </node>
    </group>



  <!-- Transforms -->
  <node pkg="tf" type="static_transform_publisher" name="baselink_to_stereo_stick_$(arg camera)" args="0.4 0.0 0.8 0.0 0.0 0.0 /baselink /$(arg base_topic)_stick 100" />
  <node pkg="tf" type="static_transform_publisher" name="stereo_stick_to_stereo_base_$(arg camera)" args="0.0 0.0 0.0 1.57 0.0 1.57 /$(arg base_topic)_stick /$(arg base_topic)/base 100" />
  <node pkg="tf" type="static_transform_publisher" name="stereo_base_to_stereo_$(arg camera)" args="0.0 0.0 0.0 0.0 0.0 -1.57 /$(arg base_topic)/base /$(arg base_topic) 100" />
  <node pkg="tf" type="static_transform_publisher" name="stereo_to_left_$(arg camera)" args="-0.06 0.0 0.0 0.0 0.0 0.0 /$(arg base_topic) /$(arg base_topic)/left_optical 100" />

  <!-- Throttle -->
  <!-- <node if="$(arg throttle)" name="nav_sts_throttle" pkg="topic_tools" type="throttle" args="messages $(arg base_topic)/image_color_raw 1.0">
  </node> -->
</launch>

